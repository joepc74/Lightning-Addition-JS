<!DOCTYPE html>
<html>
    <head>
        <title>Generador Lighting Addition</title>
		<link href="estilo.css" rel="stylesheet">
		<script src="https:///cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" type="text/javascript"></script>
    </head>
    <body>
      <div class="m-3 rounded-lg bg-slate-100 p-2 drop-shadow-lg inline-block">
        <h1 class="mb-2 text-lg font-bold">Generador Lighting Addition</h1>
        <div class="flex">
          <div class="mr-6">
            <div class="flex">
              <div>
              <label for="total">Suma parcial:</label>
              <select class="form-select entradaform" name="total" id="total" onChange="cambiaguia();">
                      <option value="11" selected="true">11 *</option>
                      <option value="12">12</option>
                      <option value="13">13</option>
                      <option value="14">14</option>
                      <option value="15">15</option>
                      <option value="17">17 *</option>
                      <option value="20">20</option>
              </select></div>
              <div class="text-xs ml-3">* mejor opci&oacute;n</div>
            </div>
            <div>
              <label for="numrows">N&uacute;mero de filas:</label>
              <input type="number" class="form-input entradaform" name="numrows" value="4" min="1" max="5" step="1" id="numrows" />
            </div>
            <div>
              <label for="numcols">N&uacute;mero de columnas:</label>
              <input type="number" class="form-input entradaform" name="numcols" value="4" min="1" max="5" step="1" id="numcols" />
            </div>
            <div>
              <label for="numpages">N&uacute;mero de p&aacute;ginas:&nbsp;</label>
              <input type="number" class="form-input entradaform" name="numpages" value="1" min="1" max="100" step="1" id="numpages" />
            </div>
            <div>
              <button
                type="button"
                class="inline-block rounded bg-blue-600 px-6 py-2.5 text-xs font-medium uppercase leading-tight text-white shadow-md transition duration-150 ease-in-out hover:bg-blue-700 hover:shadow-lg focus:bg-blue-700 focus:shadow-lg focus:outline-none focus:ring-0 active:bg-blue-800 active:shadow-lg"
                name="button"
                id="button"
                onclick="lightingaddition(
                        parseInt(document.getElementById('total').value),
                        parseInt(document.getElementById('numcols').value),
                        parseInt(document.getElementById('numrows').value),
                        parseInt(document.getElementById('numpages').value));"
              >
                Generar
              </button>
            </div>
          </div>
          <div class="fit m-2 rounded-xl bg-slate-300 p-2 drop-shadow-lg">
            <div class="flex justify-center text-lg font-bold" id="titulo">11</div>
            <table class="border-separate rounded-md bg-white">
              <tr>
                <td class="circulo"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
              </tr>
              <tr>
                <td class="circulo"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
              </tr>
              <tr>
                <td class="circulo font-bold" id="pos1">1</td>
                <td class="circulo bg-green-600 font-bold" id="pos2">+2</td>
                <td class="circulo bg-green-600 font-bold" id="pos3">+2</td>
                <td class="circulo bg-green-600 font-bold" id="pos4">+2</td>
                <td class="circulo bg-green-600 font-bold" id="pos5">+1</td>
              </tr>
              <tr>
                <td class="circulo"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
                <td class="circulo bg-violet-400"></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </body>
<script>
function lightingaddition(total,cols,rows,pages) {
    // min and max of cols of random numbers
    const minmax={11:[[0,7],[0,8]],12:[[0,6],[0,7]],13:[[0,5],[0,6]],14:[[0,4],[0,5]],15:[[0,3],[0,4]],17:[[2,9],[3,9]],20:[[0,7],[0,7]]}
    // font size
    const tamfuente={4:145,5:135}


    var doc = new jspdf.jsPDF({orientation: "landscape",unit: "mm", format:"a4"});
    let widthhpage=doc.internal.pageSize.getWidth()-10 // descuento 10 de margen por cada lado
    let heightpage=doc.internal.pageSize.getHeight()-20 // descuento 10 de margen por cada lado

    doc.setFont("Arial","bold");
    doc.setFontSize(145);

    let poscol=[25]
    while (poscol.length<cols) {
    	poscol.push(poscol.at(-1)+widthhpage/cols);
      }
    let posfila=[50]
    while (posfila.length<rows) {
    	posfila.push(posfila.at(-1)+heightpage/rows);
      }

    let comb=generate_comb([],rows-1,total);
    
    
    for (let page=0;page<pages;page++) {
        if (page>0) doc.addPage();
        for (let colum=0;colum<cols;colum++) {
            let numeros=rand(comb);
            if (colum==(cols-1)) {
                numeros.splice(rows-2,0,getRndInteger(minmax[total][1][0],minmax[total][1][1]));
            } else {
                numeros.splice(rows-2,0,getRndInteger(minmax[total][0][0],minmax[total][0][1]));
                }
            for (fila=0;fila<rows;fila++) doc.text(numeros[fila].toString(), poscol[colum], posfila[fila]);
            }
       }
    doc.save(`LightingAddition_total_${total}_${cols}x${rows}_${pages}_pages.pdf`);
}

function generate_comb(val,rows,total) {    
    if ((val.length>0) && (val[0].length===rows)) {
        return val.filter(x=>x.reduce((a, b) => a + b, 0) === total);
    }
    let newval=[];
    for (let num=0;num<10;num++) {
        if (val.length===0) {
            newval.push([num]);
        }else {
            val.forEach(element => {
                newval.push([...element,...[num]]);
            });
        }
    }   
    return generate_comb(newval,rows,total);
}

function rand(items) {
    return items[items.length * Math.random() | 0];
}

function getRndInteger(min, max) {
  return Math.floor(Math.random() * (max - min + 1) ) + min;
}
</script>	
<script>
guias={11:['1','+2','+1'],12:['1','+3','+2'],13:['1','+4','+3'],14:['1','+5','+4'],15:['1','+6','+5'],17:['2','-1','-3'],20:['2','+2','&nbsp;=']}
function cambiaguia() {
  total=document.getElementById('total').value;
  document.getElementById('titulo').innerHTML =total;
  document.getElementById('pos1').innerHTML =guias[total][0];
  document.getElementById('pos2').innerHTML =guias[total][1];
  document.getElementById('pos3').innerHTML =guias[total][1];
  document.getElementById('pos4').innerHTML =guias[total][1];
  document.getElementById('pos5').innerHTML =guias[total][2];
}
cambiaguia();
</script>
</html>